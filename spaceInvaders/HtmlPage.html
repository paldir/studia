<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Space Invaders</title>

    <script src="BattleFieldManagement.js"></script>
    <script src="Drawing.js"></script>
    <script src="ShipsAndMissiles.js"></script>

    <link href="StyleSheet.css" rel="stylesheet" />
</head>
<body>
    <canvas id="battleField" width="800" height="800"></canvas>

    <script>
        var battleFieldManagement = new BattleFieldManagement();
        var drawing = new Drawing('battleField');
        var clock = 0;
        var pressedKeys = {};
       
        onkeydown = function (e) { pressedKeys[e.keyCode] = true; };
        onkeyup = function (e) { delete pressedKeys[e.keyCode]; };

        var interval = setInterval(function () { Update(); }, 10);

        function Update() {
            drawing.ClearBattleField();
            //drawing.DrawGrid();
            drawing.DrawInvaders(battleFieldManagement.invaders);
            drawing.DrawMissilesOfInvaders(battleFieldManagement.missilesOfInvaders);
            drawing.DrawHero(battleFieldManagement.hero);
            drawing.DrawMissilesOfHero(battleFieldManagement.missilesOfHero);

            if (battleFieldManagement.DestroyHero())
                clearInterval(interval);

            if (clock % 10 == 0) {
                battleFieldManagement.MoveInvaders();
                clock = 0;
            }

            if (clock % 2 == 0) {
                battleFieldManagement.MoveMissilesOfHero();
                battleFieldManagement.MoveMissilesOfInvaders();
            }

            if (Math.random() < 0.01)
                battleFieldManagement.LaunchMissileOfInvader();

            battleFieldManagement.DestroyInvaders();
            battleFieldManagement.HandleKeys(pressedKeys);

            clock++;
        }
    </script>
</body>
</html>
